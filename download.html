<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NVC Admin - Attendance</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * { box-sizing: border-box; font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; }
        
        body { 
            margin: 0; 
            background: linear-gradient(135deg, #1f1f1f, #0a6a7c, #000000); 
            background-attachment: fixed;
            color: white; 
            height: 100vh;
            overflow: hidden;
        }

        .main-layout { display: flex; height: 100vh; }

        /* Sidebar Navigation */
        nav { 
            width: 20%; 
            background-color: rgba(0, 0, 0, 0.4); 
            backdrop-filter: blur(15px);
            height: 100%; 
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .logo { text-align: center; padding: 40px 0; border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
        .logo h1 { font-size: 1.5rem; letter-spacing: 2px; color: #00d4ff; }

        nav a { 
            display: block; 
            text-decoration: none; 
            padding: 20px 30px; 
            color: rgba(255, 255, 255, 0.7); 
            transition: 0.3s; 
            font-size: 0.9rem;
            border-left: 3px solid transparent;
        }
        
        nav a:hover, .active { 
            background-color: rgba(0, 212, 255, 0.1); 
            color: #00d4ff;
            border-left: 3px solid #00d4ff;
        }

        /* Content Area */
        .content-area { 
            width: 80%; 
            padding: 60px; 
            overflow-y: auto; 
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        /* Glass Cards */
        .glass-card { 
            background: rgba(255, 255, 255, 0.05); 
            backdrop-filter: blur(20px);
            padding: 40px; 
            border-radius: 20px; 
            border: 1px solid rgba(255, 255, 255, 0.1); 
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        }

        h2, h1 { margin-top: 0; font-weight: 300; }

        /* Form Elements */
        .input-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            justify-content: center;
        }

        input[type="text"] {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 10px;
            color: white;
            width: 100%;
            max-width: 400px;
            outline: none;
            transition: 0.3s;
        }

        input[type="text"]:focus {
            background: rgba(255, 255, 255, 0.15);
            border-color: #00d4ff;
        }

        .btn { 
            background: #00d4ff; 
            color: #002b36; 
            padding: 15px 35px; 
            border-radius: 10px; 
            text-decoration: none; 
            font-weight: bold; 
            border: none;
            cursor: pointer;
            transition: 0.3s ease;
            display: inline-block;
        }

        .btn:hover { 
            background: white; 
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 212, 255, 0.3);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            margin-top: 20px;
        }

        p { color: rgba(255, 255, 255, 0.6); line-height: 1.6; }
    </style>
</head>
<body>
    <div class="main-layout">
        <nav>
            <div class="logo"><h1>NVC ADMIN</h1></div>
            <a href="index.html">News and Updates</a>
            <a href="members.html">Members</a>
            <a href="gallery.html">Gallery</a> 
            <a href="download.html">Attendance</a> 
            <a href="#">Logout</a>
        </nav>
        
        <div class="content-area">
            <div class="glass-card">
                <h2>Manage Current Event</h2>
                <p>Changing this name will instantly update the title on the registration form.</p>
                <div class="input-group">
                    <input type="text" id="event-input" placeholder="e.g. Annual Tech Meet 2024">
                    <button onclick="updateEvent()" class="btn">Save Event</button>
                </div>
            </div>

            <div class="glass-card">
                <h1>Attendance Records</h1>
                <p>Generate a professional Excel report of all students who have registered through the portal.</p>
                <button onclick="downloadExcel()" class="btn btn-secondary">
                    Download .XLSX Sheet
                </button>
            </div>
        </div>
    </div>

<script>
    // 1. Initialize Supabase (Replace with your keys)
      const SUPABASE_URL = 'https://lgbgobzasuqozdkvxifk.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxnYmdvYnphc3Vxb3pka3Z4aWZrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg0ODg3OTcsImV4cCI6MjA4NDA2NDc5N30.a64sYwLUfGd1qNqg9Vfon_DqvrntkMiB1v-l6tPoITM';
    const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);


    
   async function updateEvent() {
    const newEvent = document.getElementById('event-input').value;
    if(!newEvent) return alert("Please enter an event name");

    // UPDATED: Using 'event_name' as requested
    const { error } = await _supabase
        .from('settings')
        .update({ current_event: newEvent }) 
        .eq('id', 1);

    if (error) {
        alert("Error: " + error.message);
    } else {
        alert("Event updated successfully!");
        document.getElementById('event-input').value = "";
    }
}

  

async function downloadExcel() {
    const { data, error } = await _supabase
        .from('attendance')
        .select('student_name, id, event_name, date, position');

    if (error || !data) return alert("Error fetching data");
    if (data.length === 0) return alert("No records found.");

    // 1. Create the worksheet from JSON
    const worksheet = XLSX.utils.json_to_sheet(data);

    // 2. SET COLUMN WIDTHS (The new part)
    // wch = "Width in Characters"
    const colWidths = [
        { wch: 25 }, // student_name column width
        { wch: 10 }, // id column width
        { wch: 30 }, // event_name column width
        { wch: 15 }, // date column width
        { wch: 20 }  // position column width
    ];
    worksheet['!cols'] = colWidths;

    // 3. Create the workbook and append the sheet
    const workbook = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(workbook, worksheet, "Attendance");

    // 4. Trigger download
    XLSX.writeFile(workbook, "NVC_Attendance_Report.xlsx");
}
</script>
</body>
</html>













